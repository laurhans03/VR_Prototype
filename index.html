<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Mein VR-Prototyp</title>

    <!-- Load the A-Frame framework for building WebVR scenes -->
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
</head>

<body>
    <!-- Display a loading message before the scene is fully initialized -->
    <div id="loading">Loading scene...</div>


    <!-- Main VR scene container -->
    <a-scene>
        <!-- Video assets -->
        <a-assets>
            <img id="menu_img" src="media/menu.png">
        </a-assets>



        <!-- Menu 1 -->
        <a-entity id="menu" visible="true">
            <a-videosphere src="#menu_img" rotation="0 -102 0"></a-videosphere>

            <!-- Define the user's camera and enable head movement tracking -->
            <a-entity id="camera" camera look-controls position="0 1.3 0" raycaster="objects: .clickable">
                <a-entity id="cursorBase" cursor="fuse: true; fuseTimeout: 2000" position="0 0 -0.5"
                    geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                    material="color: transparent; shader: flat">
                </a-entity>

                <a-ring id="progressRing" radius-inner="0.011" radius-outer="0.02" position="0 0 -0.5" color="#FFD700"
                    theta-start="0" theta-length="0">
                </a-ring>
            </a-entity>

            
            <!-- Display a welcome message floating in front of the user -->
            <a-text value="Welcome!" align="center" position="0 2.5 -2" color="#ffffff" width="3"></a-text>
        </a-entity> 

        <!-- Enable hand tracking for left and right hands -->
        <a-entity id="leftHand" hand-tracking-controls="hand: left"></a-entity>
        <a-entity id="rightHand" hand-tracking-controls="hand: right"></a-entity>


    </a-scene>

    <script>
        window.onload = async () => {
            // JSON laden
            const response = await fetch('videos.json');
            const data = await response.json();

            const menu = document.querySelector('#menu');
            const assets = document.querySelector('a-assets');

            // Für jedes Video aus der JSON
            data.videos.forEach((video, i) => {
                // Video-Asset erzeugen
                const videoEl = document.createElement('video');
                videoEl.setAttribute('id', video.id);
                videoEl.setAttribute('src', video.src);
                videoEl.setAttribute('autoplay', '');
                videoEl.setAttribute('loop', '');
                videoEl.setAttribute('muted', '');
                videoEl.setAttribute('playsinline', '');
                videoEl.setAttribute('crossorigin', 'anonymous');
                assets.appendChild(videoEl);

                // Menü-Eintrag erzeugen
                const entry = document.createElement('a-entity');
                entry.classList.add('clickable');
                entry.setAttribute('id', `to-${video.id}`);

                // ---- Position auf der Kugel berechnen ----
                // "x" = horizontaler Winkel, "y" = vertikaler Winkel (beides in Grad)
                const [angleYDeg, angleXDeg] = video.position.split(' ').map(Number);
                const radius = 3; // Abstand von der Mitte (Kugelradius)
                const angleY = THREE.MathUtils.degToRad(angleYDeg); // horizontal
                const angleX = THREE.MathUtils.degToRad(angleXDeg); // vertikal

                // Kugelkoordinaten → kartesisch
                const posX = radius * Math.sin(angleY) * Math.cos(angleX);
                const posY = radius * Math.sin(angleX);
                const posZ = -radius * Math.cos(angleY) * Math.cos(angleX);

                // const radius = 3;
                // const angleY = THREE.MathUtils.degToRad(angleYDeg);

                // const posX = radius * Math.sin(angleY);
                // const posY = 0; // oder z. B. 1.5 für Augenhöhe
                // const posZ = -radius * Math.cos(angleY);

                entry.setAttribute('position', `${posX} ${posY} ${posZ}`);
                entry.setAttribute('look-at', '[camera]'); // immer zur Kamera drehen

                // Container für Icon+Text
                // const container = document.createElement('a-entity');
                // container.setAttribute('position', `${posX} ${posY} ${posZ}`);
                // container.setAttribute('look-at', '[camera]'); // Container immer frontal zur Kamera

                // ---- Icon ----
                const icon = document.createElement('a-image');
                icon.setAttribute('src', 'media/videoicon.png');
                icon.setAttribute('width', '0.5');
                icon.setAttribute('height', '0.5');
                icon.setAttribute('position', '0 0 0');
                icon.setAttribute('material', 'color: white; opacity: 0.9');
                entry.appendChild(icon);

                // ---- Text ----
                const text = document.createElement('a-text');
                text.setAttribute('value', video.title);
                text.setAttribute('align', 'center');
                text.setAttribute('position', '0 -0.4 0');
                text.setAttribute('width', '2');
                text.setAttribute('color', 'white');
                entry.appendChild(text);

                // ---- Menü-Eintrag hinzufügen ----
                menu.appendChild(entry);

                // ---- Cursor-Interaktion ----
                entry.addEventListener('mouseenter', () => {
                    progressRing.removeAttribute('animation__fill');
                    progressRing.setAttribute('animation__fill',
                    'property: theta-length; from: 0; to: 360; dur: 2000; easing: linear'
                    );
                });

                entry.addEventListener('mouseleave', () => {
                    progressRing.removeAttribute('animation__fill');
                    progressRing.setAttribute('theta-length', 0);
                });

                entry.addEventListener('click', () => {
                    menu.setAttribute('visible', 'false');
                    const room = document.createElement('a-entity');
                    room.setAttribute('id', video.id);
                    room.innerHTML = `<a-videosphere src="#${video.id}" rotation="0 0 0"></a-videosphere>`;
                    document.querySelector('a-scene').appendChild(room);
                });
                });

            document.getElementById('loading').style.display = 'none';
        };
        </script>
    
    <!-- <script>
        // Videos sicher starten
        window.onload = () => {
            document.querySelector('#video1').play();
            document.querySelector('#video2').play();
        };

        // const cursor = document.querySelector('#cursorRing');
        const button = document.querySelector('#toRoom2');
        const room1 = document.querySelector('#room1');
        const room2 = document.querySelector('#room2');
        const progressRing = document.querySelector('#progressRing');

        button.addEventListener('mouseenter', () => {
            progressRing.removeAttribute('animation'); // Reset vorheriger Animationszustand
            progressRing.setAttribute('animation', {
                property: 'theta-length',
                from: 0,
                to: 360,
                dur: 2000,
                easing: 'linear'
            });
        });

        // Fortschritt abbrechen, wenn der Blick weggeht
        button.addEventListener('mouseleave', () => {
            progressRing.removeAttribute('animation');
            progressRing.setAttribute('theta-length', 0);
        });

        // Nach 2 Sekunden (fuseTimeout) — Klick → Szene wechseln
        button.addEventListener('click', () => {
            room1.setAttribute('visible', 'false');
            room2.setAttribute('visible', 'true');
            progressRing.removeAttribute('animation');
            progressRing.setAttribute('theta-length', 0);
        });

    </script> -->


</body>

</html>